<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake Test</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #111831;
      --text: #e8eeff;
      --accent: #64ff9a;
      --danger: #ff5d73;
      --grid: #1e2a52;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at 20% 20%, #1a2450, var(--bg));
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 16px;
    }
    .wrap {
      width: min(92vw, 520px);
      background: linear-gradient(180deg, #141d3a, var(--panel));
      border: 1px solid #2a386d;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,.35);
    }
    h1 { margin: 0 0 12px; font-size: 22px; }
    .hud {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 12px;
      font-weight: 600;
    }
    .chip {
      background: #0d1430;
      border: 1px solid #2a386d;
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 14px;
    }
    canvas {
      width: 100%;
      aspect-ratio: 1 / 1;
      background:
        linear-gradient(90deg, transparent 24px, var(--grid) 25px),
        linear-gradient(180deg, transparent 24px, var(--grid) 25px),
        #0b1230;
      background-size: 25px 25px;
      border-radius: 12px;
      border: 1px solid #30407a;
      display: block;
    }
    .controls {
      margin-top: 12px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      border: 1px solid #2c3b72;
      background: #111a3e;
      color: var(--text);
      border-radius: 10px;
      padding: 10px 12px;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover { filter: brightness(1.1); }
    .hint { margin-top: 10px; font-size: 13px; opacity: .85; }
    .gameover { color: var(--danger); font-weight: 700; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ Snake Test</h1>
    <div class="hud">
      <div class="chip">Score: <span id="score">0</span></div>
      <div class="chip">Best: <span id="best">0</span></div>
      <div class="chip" id="status">Ready</div>
    </div>
    <canvas id="game" width="500" height="500"></canvas>
    <div class="controls">
      <button id="startBtn">Start / Restart</button>
      <button data-dir="up">â¬†ï¸</button>
      <button data-dir="left">â¬…ï¸</button>
      <button data-dir="down">â¬‡ï¸</button>
      <button data-dir="right">â¡ï¸</button>
    </div>
    <div class="hint">ç”¨éµç›¤æ–¹å‘éµ / WASD æ§åˆ¶ã€‚æ’ç‰†æˆ–æ’åˆ°è‡ªå·±å°±çµæŸã€‚</div>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const statusEl = document.getElementById('status');
    const startBtn = document.getElementById('startBtn');

    const grid = 20;
    const tile = canvas.width / grid;
    let snake, dir, nextDir, food, score, timer, speed;
    let running = false;

    const bestKey = 'snake_best_score';
    bestEl.textContent = localStorage.getItem(bestKey) || 0;

    function randCell() {
      return Math.floor(Math.random() * grid);
    }

    function spawnFood() {
      while (true) {
        const f = { x: randCell(), y: randCell() };
        if (!snake.some(s => s.x === f.x && s.y === f.y)) return f;
      }
    }

    function reset() {
      snake = [{ x: 10, y: 10 }];
      dir = { x: 1, y: 0 };
      nextDir = { x: 1, y: 0 };
      score = 0;
      speed = 120;
      food = spawnFood();
      scoreEl.textContent = score;
      statusEl.textContent = 'Running';
      statusEl.classList.remove('gameover');
      running = true;
      clearInterval(timer);
      timer = setInterval(tick, speed);
      draw();
    }

    function setDirection(d) {
      if (!running) return;
      if (d.x === -dir.x && d.y === -dir.y) return;
      nextDir = d;
    }

    function tick() {
      dir = nextDir;
      const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

      if (head.x < 0 || head.y < 0 || head.x >= grid || head.y >= grid ||
          snake.some(s => s.x === head.x && s.y === head.y)) {
        gameOver();
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score += 10;
        scoreEl.textContent = score;
        food = spawnFood();

        if (speed > 70 && score % 50 === 0) {
          speed -= 8;
          clearInterval(timer);
          timer = setInterval(tick, speed);
        }
      } else {
        snake.pop();
      }

      draw();
    }

    function gameOver() {
      running = false;
      clearInterval(timer);
      statusEl.textContent = 'Game Over';
      statusEl.classList.add('gameover');

      const best = Number(localStorage.getItem(bestKey) || 0);
      if (score > best) {
        localStorage.setItem(bestKey, score);
        bestEl.textContent = score;
      }
    }

    function drawRect(x, y, color, radius=0) {
      const px = x * tile, py = y * tile;
      ctx.fillStyle = color;
      if (!radius) return ctx.fillRect(px + 1, py + 1, tile - 2, tile - 2);
      const w = tile - 2, h = tile - 2, r = radius;
      const xx = px + 1, yy = py + 1;
      ctx.beginPath();
      ctx.moveTo(xx + r, yy);
      ctx.arcTo(xx + w, yy, xx + w, yy + h, r);
      ctx.arcTo(xx + w, yy + h, xx, yy + h, r);
      ctx.arcTo(xx, yy + h, xx, yy, r);
      ctx.arcTo(xx, yy, xx + w, yy, r);
      ctx.closePath();
      ctx.fill();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // food
      drawRect(food.x, food.y, '#ff5d73', 8);

      // snake
      snake.forEach((p, i) => drawRect(p.x, p.y, i === 0 ? '#64ff9a' : '#2ee68a', 6));
    }

    document.addEventListener('keydown', (e) => {
      const k = e.key.toLowerCase();
      if (["arrowup","w"].includes(k)) setDirection({ x: 0, y: -1 });
      if (["arrowdown","s"].includes(k)) setDirection({ x: 0, y: 1 });
      if (["arrowleft","a"].includes(k)) setDirection({ x: -1, y: 0 });
      if (["arrowright","d"].includes(k)) setDirection({ x: 1, y: 0 });
    });

    document.querySelectorAll('button[data-dir]').forEach(btn => {
      btn.addEventListener('click', () => {
        const d = btn.dataset.dir;
        if (d === 'up') setDirection({ x: 0, y: -1 });
        if (d === 'down') setDirection({ x: 0, y: 1 });
        if (d === 'left') setDirection({ x: -1, y: 0 });
        if (d === 'right') setDirection({ x: 1, y: 0 });
      });
    });

    startBtn.addEventListener('click', reset);
    draw();
  </script>
</body>
</html>
